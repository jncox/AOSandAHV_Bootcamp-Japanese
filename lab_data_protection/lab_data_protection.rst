.. _lab_data_protection:

---------------------
データプロテクション
---------------------

概要
++++++++

Nutanixは、VM/vDiskレベルのストレージスナップショットを実行する機能を提供します。保護ドメイン（PD）は、VMをグループ化し、スナップショットポリシーとレプリケーションポリシーを適用するための構成要素です。

この演習では、Prismを使用してVMスナップショットの作成と復元、およびVMの保護ドメインの作成を行います。

データプロテクション
+++++++++++++++

VM スナップショット
............

#. **Prism Element > VM > Table** と進み *Initials*-**Linux_VM** を選択します、

#. もし電源オンの場合は **Guest Shutdown** を実行します。

#. VM を選択し、表の下のメニューから **Take Snapshot** をクリックします。

#. スナップショットの名前を入力し、**Submit** をクリックします。

#. テーブルの下の **VM Snapshots** タブを選択して、選択したVMで利用可能なスナップショットを表示します。

   .. figure:: images/manage_workloads_04.png

#. **Action** で **Detail** をクリックすると、スナップショット時のVMのすべてのプロパティが表示されます。

   スナップショットには、データだけでなくVMの状態も含まれていることがわかります。

   *あなたのVMを破壊しましょう！*

#. **Update** をクリックして、CD-ROMとDISK各項目の **X** アイコンをクリックして削除します。

#. **Save** をクリックします。

#. VM の電源を入れ、そのコンソールウィンドウを起動してみてください。

   VM には起動用のディスクがなくなったためOSが起動できず、2048 ゲームが表示されていることに注意してください。

#. VMの電源をオフにします。

#. **VM Snapshots** で復元するスナップショットを選択し、
   **Restore** をクリックしてVMが機能する状態に戻します。

   **Clone** をクリックして新しいVMとしてリストアすることもできます。

#. VM が正常に起動することを確認します。

前述したように、Nutanixのスナップショットは `redirect-on-write <https://nutanixbible.com/#anchor-book-of-acropolis-snapshots-and-clones>`_ のアプローチを使用しており、他のハイパーバイザーに見られる連鎖型スナップショットのパフォーマンス低下に悩まされることはありません。

プロテクションドメイン
..................

#. **Prism Element > Data Protection > Table** と進み **+ Protection Domain > Async DR** にてPDの作成していきます。

   .. note::

      同期レプリケーション（Metro Availability）は、現在ESXiでサポートされています。将来のリリースで AHV でサポートされる予定です。

#. メニューのデータ保護コンテキストを開くと、警告画面が表示されます **OK** をクリックして進めます。

  .. figure:: images/data_protection_01.png

#.  PDの名前を入力し **Create** をクリックします。

#. フィルタ機能を使うかまたはスクロールして、このラボで作成したPDに追加する 任意のVM を探して選択します

#. **Protect Selected Entities** をクリックして、VMが **Protected Entities** に表示されることを確認します。

   Consistency groups で、同時にスナップショットをとる複数のVMをグループ化できます。(例：同じアプリケーションに属する複数のVM)

   .. note:: Nutanixスナップショットは、NGTがインストールされサポートされているオペレーティングシステムに対して、アプリケーションコンシステントなスナップショットを実行することができます。アプリケーションコンシステントなスナップショットを使用する各 VM は、自身のConsistency groupの一部です。

#. **Next** をクリックします

#. **New Schedule** をクリックして、 Recovery Point Objective (RPO) とリテンション(データの保持)を定義します。

#. スナップショット頻度を設定します（例：1時間ごとに繰り返す）

   .. note::

      AHVはNearSyncスナップショットをサポートしており、RPOは1分と低くなっています
      同じPDに複数のスケジュールを適用することができるので、時間単位、日単位、月単位のスナップショットを 複数回取得して保持することができます。

#. リテンションポリシーを設定する（例：直近の5つのスナップショットを保持する)

   .. note::

      リモートクラスタが設定されている環境では、レプリケーションの設定は、各リモートサイトに保存するスナップショットの数を定義するのと同じくらい簡単です

      .. figure:: images/snapshot_02.png

#. **Create Schedule** をクリックします

#. **Close** をクリックして終了します

追加情報は `こちら <https://nutanixbible.com/#anchor-book-of-acropolis-backup-and-disaster-recovery>`_ で確認できます。

これで完了です。これでPrismのネイティブデータ保護の設定が完了しました。

まとめ
+++++++++

- Nutanixは、1対1または1対多のレプリケーションを含む様々な戦略により、仮想データセンターのためのデータ保護ソリューションを提供します。
- NutanixはVM、ファイル、およびボリュームグループレベルでのデータ保護機能を提供し、VMとデータの安全性を維持します。
- VMレベルのスナップショットおよびレプリケーションポリシーは、サポートされているすべてのハイパーバイザーに対して、Prismを介して管理することができます。
